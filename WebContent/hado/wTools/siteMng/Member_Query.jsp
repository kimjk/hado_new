<%@ page session="true" language="java" contentType="text/html; charset=euc-kr" pageEncoding="euc-kr"%><%/*** 프로젝트명	: 하도급거래 서면실태조사 지원을 위한 개발용역 사업* 프로그램명	: Member_Query.jsp* 프로그램설명	: 내부관리툴 사용자 등록/수정 프로세스* 프로그램버전	: 1.0.1* 최초작성일자	: 2009년 05월* 작 성 이 력       :*=========================================================*	작성일자		작성자명				내용*=========================================================*	2009-05-00	정광식       최초작성*	2015-12-30	정광식		DB변경으로 인한 인코딩 변경*/%><%@ page import="java.sql.*"%><%@ page import="java.util.*"%><%@ page import="ftc.util.*"%><%@ page import="ftc.db.ConnectionResource"%><%@ page import="ftc.db.ConnectionResource2"%><%@ page import="java.text.DecimalFormat"%><%@ include file="/hado/wTools/inc/WB_I_Global.jsp"%><%@ include file="/hado/wTools/inc/WB_I_chkMngSession.jsp"%><%/*---------------------------------------- Variable Difinition ----------------------------------------*/	String sReturnURL = "";	String sErrorMsg = "";	String sSQLs = "";	int nNewNo = 0;	String sCmd = request.getParameter("cmd")==null ? "":request.getParameter("cmd").trim();			ConnectionResource resource = null;	Connection conn = null;	PreparedStatement pstmt = null;	ResultSet rs = null;	ConnectionResource2 resource2 = null;	Connection conn2 = null;	String q_ID = request.getParameter("mID")==null ? "":request.getParameter("mID").trim();	String q_No = request.getParameter("mNo")==null ? "":request.getParameter("mNo").trim();	String q_Center_Name = request.getParameter("mCenterName")==null ? "":request.getParameter("mCenterName").trim();	String q_Dept_Name = request.getParameter("mDeptName")==null ? "":request.getParameter("mDeptName").trim();	String q_User_Name = request.getParameter("mUserName")==null ? "":request.getParameter("mUserName").trim();	String q_Phone_No = request.getParameter("mPhoneNo")==null ? "":request.getParameter("mPhoneNo").trim();	String q_Permision = request.getParameter("mPermision")==null ? "":request.getParameter("mPermision").trim();	String q_Const = request.getParameter("mConst")==null ? "":request.getParameter("mConst").trim();/*-----------------------------------------------------------------------------------------------------*//*=================================== Record Selection Processing =====================================*/	if(sCmd != null && sCmd.equals("insert")) {		// 신규 관리번호 생성		try {			resource = new ConnectionResource();			conn = resource.getConnection();			sSQLs ="SELECT MAX(DEPT_SEQ) maxDEPTSEQ \n";			sSQLs+="FROM HADO_TB_FTC_User \n";			pstmt = conn.prepareStatement(sSQLs);			rs = pstmt.executeQuery();			while( rs.next() ) {				nNewNo = rs.getInt("maxDEPTSEQ");			}			rs.close();			nNewNo = nNewNo + 1;		} catch(Exception e){			e.printStackTrace();		} finally {			if ( rs != null ) try{rs.close();}catch(Exception e){}			if ( pstmt != null ) try{pstmt.close();}catch(Exception e){}			if ( conn != null ) try{conn.close();}catch(Exception e){}			if ( resource != null ) resource.release();		}		try {			resource2 = new ConnectionResource2();			conn2 = resource2.getConnection();			sSQLs ="INSERT INTO HADO_TB_FTC_User \n";			sSQLs+="	(DEPT_SEQ,CVSNO,CENTER_NAME,DEPT_NAME, USER_NAME, PHONE_NO, PERMISION, CONST) \n";			sSQLs+="VALUES (?,?,?,?, ?, ?, ?, ?) \n";			/* 2015-12-30	정광식		DB변경으로 인한 인코딩 변경			sSQLs+="	("+nNewNo+",'"+q_ID+"','"+new String(q_Center_Name.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"',"+					"'"+new String(q_Dept_Name.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"','"+new String(q_User_Name.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"','"+new String(q_Phone_No.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"',"+"'"+q_Permision+"','"+new String(q_Const.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"') \n";			*/			pstmt = conn2.prepareStatement(sSQLs);			pstmt.setString(1, nNewNo+"");			pstmt.setString(2, q_ID);			pstmt.setString(3, q_Center_Name);			pstmt.setString(4, q_Dept_Name);			pstmt.setString(5, q_User_Name);			pstmt.setString(6, q_Phone_No);			pstmt.setString(7, q_Permision);			pstmt.setString(8, q_Const);			int updateCNT = pstmt.executeUpdate();		} catch(Exception e){			e.printStackTrace();		} finally {			if ( rs != null ) try{rs.close();}catch(Exception e){}			if ( pstmt != null ) try{pstmt.close();}catch(Exception e){}			if ( conn2 != null ) try{conn2.close();}catch(Exception e){}			if ( resource2 != null ) resource2.release();		}	} else if(sCmd != null && sCmd.equals("edit")) {		try {			resource2 = new ConnectionResource2();			conn2 = resource2.getConnection();			sSQLs ="UPDATE HADO_TB_FTC_User SET \n";			/* 2015-12-30	정광식		DB변경으로 인한 인코딩 변경			sSQLs+="	CVSNO='"+q_ID+"' \n";			sSQLs+="	,Center_Name='"+ new String(q_Center_Name.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"' \n";			sSQLs+="	,Dept_Name='"+new String(q_Dept_Name.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"' \n";			sSQLs+="	,User_Name='"+new String(q_User_Name.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"' \n";			sSQLs+="	,Phone_No='"+new String(q_Phone_No.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"' \n";			sSQLs+="	,Permision='"+new String(q_Permision.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"' \n";			sSQLs+="	,Const='"+new String(q_Const.replaceAll("'","''").getBytes("EUC-KR"), "ISO8859-1" )+"' \n";			*/			sSQLs+="	CVSNO=?, Center_Name=? , Dept_Name=?, User_Name=?, Phone_No=?, Permision=?, Const=? \n";			sSQLs+="WHERE Dept_Seq=?";			pstmt = conn2.prepareStatement(sSQLs);			pstmt.setString(1, q_ID);			pstmt.setString(2, q_Center_Name);			pstmt.setString(3, q_Dept_Name);			pstmt.setString(4, q_User_Name);			pstmt.setString(5, q_Phone_No);			pstmt.setString(6, q_Permision);			pstmt.setString(7, q_Const);			pstmt.setString(8, q_No);			int updateCNT = pstmt.executeUpdate();		} catch(Exception e){			e.printStackTrace();		} finally {			if ( rs != null ) try{rs.close();}catch(Exception e){}			if ( pstmt != null ) try{pstmt.close();}catch(Exception e){}			if ( conn2 != null ) try{conn2.close();}catch(Exception e){}			if ( resource2 != null ) resource2.release();		}	} else if(sCmd != null && sCmd.equals("delUser")) {		try {			resource2 = new ConnectionResource2();			conn2 = resource2.getConnection();			sSQLs ="DELETE HADO_TB_FTC_User \n";			sSQLs+="WHERE Dept_Seq=? \n";			pstmt = conn2.prepareStatement(sSQLs);			pstmt.setString(1,q_No);			int updateCNT = pstmt.executeUpdate();		} catch(Exception e){			e.printStackTrace();		} finally {			if ( rs != null ) try{rs.close();}catch(Exception e){}			if ( pstmt != null ) try{pstmt.close();}catch(Exception e){}			if ( conn2 != null ) try{conn2.close();}catch(Exception e){}			if ( resource2 != null ) resource2.release();		}	}/*=====================================================================================================*/%><html><head>	<title></title>	<meta charset="euc-kr">	<script type="text/javascript">	//<![CDATA[		<%if( sCmd != null && sCmd.equals("insert") ) {%>		alert("사용자 정보를 등록하였습니다.");		top.setNowProcessFalse();		top.view('<%=nNewNo%>');		<%}%>			<%if( sCmd != null && sCmd.equals("edit") ) {%>		alert("사용자 정보를 수정 하였습니다.");		top.setNowProcessFalse();		top.view('<%=q_No%>');		<%}%>			<%if( sCmd != null && sCmd.equals("delUser") ) {%>		alert("사용자 정보를 삭제 하였습니다.");		top.setNowProcessFalse();		top.goSearch();		top.closeViewWin('divView');		<%}%>	//]]	</script></head><body></body></html>