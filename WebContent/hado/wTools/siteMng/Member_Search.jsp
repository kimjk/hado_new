<%@ page session="true" language="java" contentType="text/html; charset=euc-kr" pageEncoding="euc-kr"%><%/*** 프로젝트명	: 하도급거래 서면실태조사 지원을 위한 개발용역 사업* 프로그램명	: Member_Search.jsp* 프로그램설명	: 내부관리툴 사용자 검색* 프로그램버전	: 1.0.1* 최초작성일자	: 2009년 05월* 작 성 이 력       :*=========================================================*	작성일자		작성자명				내용*=========================================================*	2009-05-00	정광식       최초작성*	2015-12-30	정광식		DB변경으로 인한 인코딩 변경*/%><%@ page import="java.sql.*"%><%@ page import="java.util.*"%><%@ page import="ftc.util.*"%><%@ page import="ftc.db.ConnectionResource"%><%@ page import="ftc.db.ConnectionResource2"%><%@ include file="/hado/wTools/inc/WB_I_Global.jsp"%><%@ include file="/hado/wTools/inc/WB_I_chkMngSession.jsp"%><%@ page import="java.text.DecimalFormat"%><%/*---------------------------------------- Variable Difinition ----------------------------------------*/	String sReturnURL = "";	String sErrorMsg = "";	String sSQLs = "";	int nRecCount = 0;	String q_Permision = request.getParameter("mPermision")==null ? "":request.getParameter("mPermision").trim();	String q_Center = request.getParameter("mareacode")==null ? "":request.getParameter("mareacode").trim();	String q_User = request.getParameter("muser")==null ? "":request.getParameter("muser").trim();	ArrayList arrNo = new ArrayList();	ArrayList arrID = new ArrayList();	ArrayList arrCenter = new ArrayList();	ArrayList arrDept = new ArrayList();	ArrayList arrName = new ArrayList();	ArrayList arrTel = new ArrayList();	ArrayList arrPermision = new ArrayList();	ConnectionResource resource = null;	Connection conn = null;	PreparedStatement pstmt = null;	ResultSet rs = null;	DecimalFormat formater = new java.text.DecimalFormat("###,###,###,###,###,###,###,###");/*-----------------------------------------------------------------------------------------------------*//*=================================== Record Selection Processing =====================================*/	try {		resource = new ConnectionResource();		conn = resource.getConnection();		sSQLs ="SELECT * \n";		sSQLs+="FROM HADO_TB_FTC_User \n";		sSQLs+="WHERE CVSNO IS NOT NULL ";		if(q_Permision != null && (!q_Permision.equals("")) ) {			sSQLs+="	AND Permision='"+q_Permision+"' \n";		}		if(q_Center != null && (!q_Center.equals("")) ) {			/* 2015-12-30	정광식		DB변경으로 인한 인코딩 변경			sSQLs+="	AND Center_NAME LIKE '"+new String(selDeptName(q_Center).getBytes("EUC-KR"), "ISO8859-1" )+"%' \n";			*/			sSQLs+="	AND Center_NAME LIKE '"+selDeptName(q_Center)+"%' \n";		}		if(q_User != null & (!q_User.equals("")) ) {			/* 2015-12-30	정광식		DB변경으로 인한 인코딩 변경			sSQLs+="	AND USER_NAME LIKE '%"+new String(q_User.getBytes("EUC-KR"), "ISO8859-1" )+"%' \n";			*/			sSQLs+="	AND USER_NAME LIKE '%"+q_User+"%' \n";		}		sSQLs+="ORDER BY Center_Name,Dept_Name,User_Name \n";		pstmt = conn.prepareStatement(sSQLs);		rs = pstmt.executeQuery();		nRecCount = 1;		while( rs.next() ) {			arrNo.add( rs.getString("DEPT_SEQ")==null ? "":rs.getString("DEPT_SEQ").trim() );			arrID.add( rs.getString("CVSNO")==null ? "":rs.getString("CVSNO").trim() );			/* 2015-12-30	정광식		DB변경으로 인한 인코딩 변경			arrCenter.add(new String(StringUtil.checkNull(rs.getString("CENTER_NAME")).trim().getBytes("ISO8859-1"), "EUC-KR" ));			arrDept.add(new String(StringUtil.checkNull(rs.getString("DEPT_NAME")).trim().getBytes("ISO8859-1"), "EUC-KR" ));			arrName.add(new String(StringUtil.checkNull(rs.getString("USER_NAME")).trim().getBytes("ISO8859-1"), "EUC-KR" ));			arrTel.add(new String(StringUtil.checkNull(rs.getString("PHONE_NO")).trim().getBytes("ISO8859-1"), "EUC-KR" ));			*/			arrCenter.add( rs.getString("CENTER_NAME")==null ? "":rs.getString("CENTER_NAME").trim() );			arrDept.add( rs.getString("DEPT_NAME")==null ? "":rs.getString("DEPT_NAME").trim() );			arrName.add( rs.getString("USER_NAME")==null ? "":rs.getString("USER_NAME").trim() );			arrTel.add( rs.getString("PHONE_NO")==null ? "":rs.getString("PHONE_NO").trim() );			arrPermision.add( rs.getString("PERMISION").trim()==null ? "":rs.getString("PERMISION").trim() );			nRecCount++;		}		rs.close();		nRecCount--;	} catch(Exception e){		e.printStackTrace();	} finally {		if ( rs != null ) try{rs.close();}catch(Exception e){}		if ( pstmt != null ) try{pstmt.close();}catch(Exception e){}		if ( conn != null ) try{conn.close();}catch(Exception e){}		if ( resource != null ) resource.release();	}/*=====================================================================================================*/%><%!	public String selDeptName(String str){		String sReturnStr = "";		if(str.equals("S") ) {			sReturnStr = "서울";		} else if(str.equals("K")) {			sReturnStr = "대구";		} else if(str.equals("J")) {			sReturnStr = "대전";		} else if(str.equals("G")) {			sReturnStr = "광주";		} else if(str.equals("B") ) {			sReturnStr = "부산";		} else {			sReturnStr = "본부";		}		return sReturnStr ;	}%><script type="text/javascript">//<![CDATA[	content = "";		content+="<table id='divButton'>";	content+="	<tr>";	content+="		<td>검색된 사용자수 : <%=formater.format(arrNo.size())%>개</strong></td>";	content+="	</tr>";	content+="</table>";		content+="<table class='resultTable'>";	content+="	<tr>";	content+="		<th>순번</th>";	content+="		<th>CVS No</th>";	content+="		<th>사무소명</th>";	content+="		<th>과명</th>";	content+="		<th>사용자명</th>";	content+="		<th>전화번호</th>";	content+="		<th>관리등급</th>";	content+="	</tr>";		<%	if( arrNo.size()>0 ) {		for(int ni = 0; ni < arrNo.size(); ni++) {	%>	content+="	<tr onMouseOver='tbRow_Over(this)' onMouseOut='tbRow_Out(this)'>";	content+="		<td align='right'><%=ni+1%></td>";	content+="		<td><a href=javascript:top.view('<%=arrNo.get(ni)%>')><%=arrID.get(ni)%></a></td>";	content+="		<td><%=arrCenter.get(ni)%></td>";	content+="		<td><%=arrDept.get(ni)%></td>";	content+="		<td><%=arrName.get(ni)%></td>";	content+="		<td><%=arrTel.get(ni)%></td>";	content+="		<td>";	<%			if(arrPermision.get(ni) != null && arrPermision.get(ni).equals("M")) { %>	content+="			<font color='#003399'>관리자</font>";			<%} else if(arrPermision.get(ni) != null && arrPermision.get(ni).equals("V")) { %>	content+="			<font color='#339933'>조회</font>";			<%} else if(arrPermision.get(ni) != null && arrPermision.get(ni).equals("T")) { %>	content+="			<font color='#FF9900'>시스템관리</font>";			<%} else { %>	content+="			일반";			<%}%>	content+="		</td>";	content+="	</tr>";	<%		}	} else {	%>	content+="	<tr>";	content+="		<td colspan='7' class='noneResultset'>검색 결과가 없습니다</td>";	content+="	</tr>";	<%	}	%>	content+="</table>";		content+="<div id='divButton'>";	content+="	<ul class='lt'>";	content+="		<li class='fr'><a href=javascript:top.view('new') class='sbutton'>사용자 등록</a></li>";	content+="	</ul>";	content+="</div>";		parent.document.getElementById("divResult").innerHTML = content;	parent.setNowProcessFalse();//]]</script><%@ include file="/hado/wTools/inc/WB_I_Function.jsp"%>