<%@ page session="true" language="java" contentType="text/html; charset=euc-kr" pageEncoding="euc-kr"%><%@ page import="java.sql.*"%><%@ page import="java.util.*"%><%@ page import="ftc.util.*"%><%@ page import="ftc.db.ConnectionResource"%><%@ page import="ftc.db.ConnectionResource2"%><%@ include file="/hado/wTools/inc/WB_I_Global.jsp"%><%@ include file="/hado/wTools/inc/WB_I_chkMngSession.jsp"%><%@ page import="java.text.DecimalFormat"%><%/* -- Product Notice ----------------------------------------------------------------------------------*//*  1. 프로젝트명 : 공정관리위원회 하도급거래 서면직권실태조사					                       *//*  2. 업체정보 :																					   *//*     - 업체명 : (주)로티스아이																	   *//*	   - Project Manamger : 정광식 부장 (pcxman99@naver.com)										   *//*     - 연락처 : T) 031-902-9188 F) 031-902-9189 H) 010-8329-9909									   *//*  3. 일자 : 2009년 5월																			   *//*  4. 최초작성자 및 일자 : (주)로티스아이 정광식 / 2011-10-18										   *//*  5. 업데이트내용 (내용 / 일자)																	   *//*  6. 비고																							   *//*		1) 웹관리툴 리뉴얼 / 2011-10-18																   *//*-----------------------------------------------------------------------------------------------------*//*---------------------------------------- Variable Difinition ----------------------------------------*/	String sMngNo = StringUtil.checkNull(request.getParameter("no")).trim();	String sCYear = StringUtil.checkNull(request.getParameter("yyyy")).trim();	String sOentGB = StringUtil.checkNull(request.getParameter("gb")).trim();	String sSentNo = StringUtil.checkNull(request.getParameter("sno")).trim();	String sLoc = StringUtil.checkNull(request.getParameter("loc")).trim();	String sMsg = StringUtil.checkNull(request.getParameter("msg")).trim();		String omngno="";	String oname = "";	String smngno="";	String sname = "";	String scaptine = "";	String samt = "";	String zipcode = "";	String zipcode1 = "";	String zipcode2 = "";	String address = "";	String stel = "";	String sfax = "";	String semail = "";	String semail1 = "";	String semail2 = "";	String scompgb = "";	String scono = "";	String ssano = "";	String ssale = "";	String sempcnt = "";	String wname = "";	String worg = "";	String wjikwi = "";	String wtel = "";	String wfax = "";	String ssubcontype = "";	String returngb = "";	String resend = "";	String astatus = "";	String selgb = "";	String sstatus = "";	String wdate = "";	String sdontlogin = "";		// 해당 사무소 정보	String sDCenterName = "";	String sDDeptName = "";	String sDUserName = "";	String sDCVSNo = "";	String sDPhoneNo = "";	String sRrchFolder = "";	String reason = "";	String sSQLs = "";	ConnectionResource resource = null;	Connection conn = null;	PreparedStatement pstmt = null;	ResultSet rs = null;	DecimalFormat formater = new java.text.DecimalFormat("###,###,###,###,###,###,###,###");/*-----------------------------------------------------------------------------------------------------*//*=================================== Record Selection Processing =====================================*/	if( ( sMngNo != null && sCYear != null && sOentGB != null && sSentNo != null ) && (!sMngNo.equals("")) && (!sCYear.equals("")) && (!sOentGB.equals("")) && (!sSentNo.equals("")) ) {		// 조사표 조회를 위한 세션정보 저장		session.setAttribute("ckMngNo",			sMngNo);		session.setAttribute("ckCurrentYear",	sCYear);		session.setAttribute("ckOentGB",		sOentGB);		session.setAttribute("ckOentName",		oname);		session.setAttribute("ckSentNo",		sSentNo);		session.setAttribute("ckSentName",		sname);		session.setAttribute("ckEntGB",			"2");		try {			resource = new ConnectionResource();			conn = resource.getConnection();						StringBuffer sbSQLs = new StringBuffer();			sbSQLs.append("SELECT * \n");			sbSQLs.append("FROM HADO_VT_SOent_"+sCYear+" \n");			if(Integer.parseInt(sCYear) > 2020 ){			    sbSQLs.append("WHERE child_Mng_No = ? \n");            } else {                sbSQLs.append("WHERE Mng_No = ? \n");            }			sbSQLs.append("    AND Current_Year = ? \n");			sbSQLs.append("    AND Oent_GB = ? \n");			sbSQLs.append("    AND Sent_No = ? \n");			pstmt = conn.prepareStatement(sbSQLs.toString());                  if(Integer.parseInt(sCYear) > 2020 ){                pstmt.setString(1,sMngNo);            } else if(Integer.parseInt(sCYear)>=2012 && Integer.parseInt(sCYear)<=2020) {				pstmt.setString(1,sMngNo.substring(0,8));			} else if(sCYear.equals("2011")) {				pstmt.setString(1,sMngNo.substring(0,9));			} else {				pstmt.setString(1,sMngNo.substring(0,10));			}			//pstmt.setString(1,sMngNo);			pstmt.setString(2,sCYear);			pstmt.setString(3,sOentGB);			pstmt.setInt(4,Integer.valueOf(sSentNo).intValue() );			//pstmt.setInt(4,Integer.parseInt(sSentNo));System.out.println("sMngNo ===============>>> " + sMngNo);System.out.println("sbSQLs ===============>>> " + sbSQLs);			rs = pstmt.executeQuery();			while(rs.next()) {				omngno = StringUtil.checkNull(rs.getString("Mng_No"));				oname = StringUtil.checkNull(rs.getString("oent_Name"));				smngno = StringUtil.checkNull(rs.getString("Child_Mng_No"));				sname = StringUtil.checkNull(rs.getString("Sent_Name"));				scaptine = StringUtil.checkNull(rs.getString("Sent_Captine"));				samt = StringUtil.checkNull(rs.getString("Sent_Amt"));				zipcode = StringUtil.checkNull(rs.getString("Zip_Code"));				/*				if ( zipcode.length() == 7 ) {					zipcode1 	= zipcode.substring(0, 3);					zipcode2 	= zipcode.substring(4, 7);				} else if ( zipcode.length() == 6 ) {					zipcode1 	= zipcode.substring(0, 3);					zipcode2 	= zipcode.substring(3, 6);				}				*/				address = StringUtil.checkNull(rs.getString("Sent_Address"));				stel = StringUtil.checkNull(rs.getString("Sent_Tel"));				sfax = StringUtil.checkNull(rs.getString("Sent_Fax"));				semail = StringUtil.checkNull(rs.getString("Assign_Mail"));				if ( (semail != null) && (!semail.equals("")) ) {					if ( semail.indexOf("@") != -1 ) {						semail1	= semail.substring(0, semail.indexOf("@"));						semail2	= semail.substring(semail.indexOf("@") + 1, semail.length());					}				}				scompgb = StringUtil.checkNull(rs.getString("Comp_GB"));				scono = StringUtil.checkNull(rs.getString("Sent_Co_No"));				ssano = StringUtil.checkNull(rs.getString("Sent_Sa_No"));				ssale = StringUtil.checkNull(rs.getString("Sent_Sale"));				sempcnt = StringUtil.checkNull(rs.getString("Sent_Emp_Cnt"));				wname = StringUtil.checkNull(rs.getString("Writer_Name"));				worg = StringUtil.checkNull(rs.getString("Writer_ORG"));				wjikwi = StringUtil.checkNull(rs.getString("Writer_Jikwi"));				wtel = StringUtil.checkNull(rs.getString("Writer_Tel"));				wfax = StringUtil.checkNull(rs.getString("Writer_Fax"));				wdate = StringUtil.checkNull(rs.getString("Writer_Date"));				ssubcontype = StringUtil.checkNull(rs.getString("Subcon_Type"));				returngb = StringUtil.checkNull(rs.getString("Return_GB"));				resend = StringUtil.checkNull(rs.getString("Resend_GB"));				astatus = StringUtil.checkNull(rs.getString("Addr_Status"));				selgb = StringUtil.checkNull(rs.getString("Sel_GB"));				sstatus = StringUtil.checkNull(rs.getString("Sent_Status"));				sdontlogin = StringUtil.checkNull(rs.getString("Dont_Login"));				sDCVSNo = StringUtil.checkNull(rs.getString("CVSNO")).trim();				sDCenterName = StringUtil.checkNull(rs.getString("Center_Name")).trim();				sDDeptName = StringUtil.checkNull(rs.getString("Dept_Name")).trim();				sDUserName = StringUtil.checkNull(rs.getString("User_Name")).trim();				sDPhoneNo = StringUtil.checkNull(rs.getString("Phone_No")).trim();			}			//rs.close();			sSQLs="SELECT REPLACE(REPLACE(SUBJ_ANS, CHR(10), ''), CHR(13), '') SUBJ_ANS FROM HADO_TB_SOENT_ANSWER_"+sCYear+" \n";			sSQLs+="WHERE MNG_NO = '"+sMngNo+"' \n";			sSQLs+="AND CURRENT_YEAR = '"+sCYear+"' \n";			sSQLs+="AND OENT_GB = '"+sOentGB+"' \n";			sSQLs+="AND SENT_NO = "+sSentNo+" \n";			sSQLs+="AND SOENT_Q_CD = 30 AND SOENT_Q_GB = 1 \n";			pstmt = conn.prepareStatement(sSQLs);			rs = pstmt.executeQuery();			while (rs.next()) {				reason = StringUtil.checkNull(rs.getString("SUBJ_ANS")).trim();			}			rs.close();		} catch(Exception e) {			e.printStackTrace();		} finally {			if ( rs != null )	try{rs.close();}	catch(Exception e){}			if ( pstmt != null )try{pstmt.close();}	catch(Exception e){}			if ( conn != null ) try{conn.close();}	catch(Exception e){}			if ( resource != null ) resource.release();		}	}/*=====================================================================================================*/%><%!public String subcontypef(String str){	String sReturnStr = "";		if(str!= null && str.equals("1")){		sReturnStr="하도급을 주기만 함";	} else if(str!= null && str.equals("2")){		sReturnStr="하도급을 주기도 하고 받기도 함";	} else if(str!= null && str.equals("3")){		sReturnStr="하도급을 받기만 함";	} else if(str!= null && str.equals("4")){		sReturnStr="하도급을 주지도 않고 받지도 않음";	}else{		sReturnStr="&nbsp;";	}		return sReturnStr ;}public String astatusf(String str){	String sReturnStr = "";		if(str!= null && str.equals("1")){		sReturnStr="소재불명";	} else if(str!= null && str.equals("2")){		sReturnStr="하도급거래없음";	} else if(str!= null && str.equals("3")){		sReturnStr="수급사업자요건안됨";	} else if(str!= null && str.equals("4")){		sReturnStr="해당년도 조사 중복업체";	}else{		sReturnStr="&nbsp;";	}		return sReturnStr;}public String isselected(String str1, String str2){	String sReturnStr = "";		if(str1 != null && str2 != null && str1.equals(str2) ) {		sReturnStr = " selected";	}	return sReturnStr;}%><script language="javascript">content = "";content+="<div id='viewWinTop'>";content+="	<ul class='lt'>";content+="		<li class='fr'><a href=javascript:closeViewWin('divView') class='sbutton'>창닫기</a></li>";content+="	</ul>";content+="</div>";content+="<div id='viewWinTitle'>수급사업자 상세정보 수정</div>";content+="<table class='ViewResultTable' align='center'>";content+="	<tr>";content+="		<th>원사업자관리번호</th>";content+="		<td>&nbsp;<%=omngno%></td>";content+="		<th>원사업자명</th>";content+="		<td>&nbsp;<%=oname%></td>";content+="	</tr>";content+="</table>";content+="<table class='ViewResultTable' align='center'>";content+="<form method='post' name='info'>";content+="	<tr>";content+="		<th>원사업자명</th>";content+="		<td>&nbsp;<input type='text' name='oname' value='<%=oname%>' class='s_input'></td>";content+="		<th>관리번호</th>";content+="		<td>&nbsp;<%=smngno%><input type='hidden' name='no' value='<%=smngno%>'><input type='hidden' name='yyyy' value='<%=sCYear%>'><input type='hidden' name='gb' value='<%=sOentGB%>'><input type='hidden' name='sno' value='<%=sSentNo%>'></td>";content+="	</tr>";content+="	<tr>";content+="		<th>수급사업자명</th>";content+="		<td>&nbsp;<input type='text' name='rcomp' value='<%=sname%>' class='s_input'></td>";content+="		<th>대표자명</th>";content+="		<td>&nbsp;<input type='text' name='scaptine' value='<%=scaptine%>' class='s_input'></td>";content+="	</tr>";content+="	<tr>";content+="		<th>우편번호</th>";content+="		<td>&nbsp;&nbsp;<input type='text' name='rpost' id='zipcode' value='<%=zipcode%>' maxlength='6' class='s_input' style='width:100px;'><a href=javascript:top.OpenPost_w('zipcode','oaddress') class='sbutton'>우편번호찾기</a></td>";content+="		<th>주소</th>";content+="		<td>&nbsp;<input type='text' name='raddr' value='<%=address%>' id='oaddress' class='s_input'></td>";content+="	</tr>";content+="	<tr>";content+="		<th>전화번호</th>";content+="		<td>&nbsp;<input type='text' name='stel' value='<%=stel%>' class='s_input'></td>";content+="		<th>팩스번호</th>";content+="		<td>&nbsp;<input type='text' name='sfax' value='<%=sfax%>' class='s_input'></td>";content+="	</tr>";content+="	<tr>";content+="		<th>사업자구분</th>";content+="		<td>&nbsp;";content+="			<select name='scogb'>";content+="				<option value=''></option>";content+="				<option value='0' <%=isselected(scompgb,"0")%>>개인 사업자</option>";content+="				<option value='1' <%=isselected(scompgb,"1")%>>법인 사업자</option>";content+="			</select>";content+="</td>";content+="		<th>법인번호</th>";content+="		<td>&nbsp;<input type='text' name='scono' value='<%=scono%>' class='s_input'></td>";content+="	</tr>";content+="	<tr>";content+="		<th>사업자등록번호</th>";content+="		<td>&nbsp;<input type='text' name='ssano' value='<%=ssano%>' class='s_input'></td>";content+="		<th>자산총액</th>";content+="		<td>&nbsp;<input type='text' name='samt' value='<%=samt%>' class='s_input' style='width:100px;text-align:right;'>백만원</td>";content+="	</tr>";content+="	<tr>";content+="		<th>매출액</th>";content+="		<td>&nbsp;<input type='text' name='ssale' value='<%=ssale%>' class='s_input' style='width:100px;text-align:right;'>백만원</td>";content+="		<th>상시종업원수</th>";content+="		<td>&nbsp;<input type='text' name='sempcnt' value='<%=sempcnt%>' class='s_input' style='width:100px;text-align:right;'>명</td>";content+="	</tr>";content+="	<tr>";content+="		<th>작성자소속</th>";content+="		<td>&nbsp;<input type='text' name='worg' value='<%=worg%>' class='s_input'></td>";content+="		<th>작성자직위</th>";content+="		<td>&nbsp;<input type='text' name='wjikwi' value='<%=wjikwi%>' class='s_input'></td>";content+="	</tr>";content+="	<tr>";content+="		<th>작성자</th>";content+="		<td>&nbsp;<input type='text' name='wname' value='<%=wname%>' class='s_input'></td>";content+="		<th>작성자전화</th>";content+="		<td>&nbsp;<input type='text' name='wtel' value='<%=wtel%>' class='s_input'></td>";content+="	</tr>";content+="	<tr>";content+="		<th>작성자팩스</th>";content+="		<td>&nbsp;<input type='text' name='wfax' value='<%=wfax%>' class='s_input'></td>";content+="		<th>담당자 E-mail</th>";content+="		<td>&nbsp;<input type='text' name='semail' value='<%=semail%>' class='s_input'></td>";content+="	</tr>";content+="	<tr>";content+="		<th>전송여부</th>";content+="		<td>&nbsp;";content+="				<select name='sstatus'>";content+="					<option value=''>미 전 송</option>";content+="					<option value='1' <%=isselected(sstatus,"1")%>>전 송</option>";content+="				</select>";content+="		</td>";content+="		<th>반송여부</th>";content+="		<td>&nbsp;";content+="			<select name='returngb'>";content+="				<option value=''></option>";content+="				<option value='1' <%=isselected(returngb,"1")%>>반 송</option>";content+="			</select>";content+="		</td>";content+="	</tr>";content+="	<tr>";content+="		<th>소재불명여부</th>";content+="		<td>&nbsp;";content+="			<select name='astatus'>";content+="				<option value=''></option>";content+="				<option value='1' <%=isselected(astatus,"1")%>>소재불명</option>";content+="				<option value='2' <%=isselected(astatus,"2")%>>하도급거래없음</option>";content+="				<option value='3' <%=isselected(astatus,"3")%>>수급사업자요건안됨</option>";content+="				<option value='4' <%=isselected(astatus,"4")%>>중복업체</option>";content+="			</select>";content+="		</td>";content+="		<th>접속차단</th>";content+="		<td>&nbsp;";content+="			<select name='dontlogin'>";content+="				<option value='N'>접속가능</option>";content+="				<option value='Y' <%=isselected(sdontlogin,"Y")%>>접속차단</option>";content+="			</select>";content+="		</td>";content+="	</tr>";		<%if( reason != null && !reason.equals("")){%>content+="	<tr>";content+="		<th>조사제외사유</th>";content+="		<td colspan='3'><%=reason%></td>";content+="	</tr>";		<%}%>content+="	</form>";content+="</table>";content+="<div id='divViewWinbutton'>";content+="	<ul class='lt'>";content+="		<li class='fl'><a href=javascript:top.f_EditSubmit(document.info) class='sbutton'>정보수정실행</a></li>";content+="		<li class='fr'><a href=javascript:top.closeViewWin('divView') class='sbutton'>창닫기</a></li>";content+="	</ul>";content+="</div>";top.document.getElementById("divView").innerHTML = content;top.document.getElementById("divView").className = "dragLayer";top.setNowProcessFalse();</script>