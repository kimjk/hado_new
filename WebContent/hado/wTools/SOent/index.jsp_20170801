<%@ page session="true" language="java" contentType="text/html; charset=euc-kr" pageEncoding="euc-kr"%><%/*** 프로젝트명	: 하도급거래 서면실태조사 지원을 위한 개발용역 사업* 프로그램명	: index.jsp* 프로그램설명	: 수급사업자 > 제출현황 > 조사대상 업체* 프로그램버전	: 1.0.1* 최초작성일자	: 2009년 05월* 작 성 이 력       :*=========================================================*	작성일자		작성자명				내용*=========================================================*	2009-05-00	정광식       최초작성*   2010-05-03	정광식		담당조사관 정보 추가*   2011-10-18   정광식		웹관리툴 리뉴얼*	2016-01-15	이용광		DB변경으로 인한 인코딩 변경*/%><%@ page import="java.sql.*"%><%@ page import="java.util.*"%><%@ page import="ftc.util.*"%><%@ page import="ftc.db.ConnectionResource"%><%@ page import="ftc.db.ConnectionResource2"%><%@ page import="java.text.DecimalFormat"%><%@ include file="/hado/wTools/inc/WB_I_Global.jsp"%><%@ include file="/hado/wTools/inc/WB_I_chkMngSession.jsp"%><%/*---------------------------------------- Variable Difinition ----------------------------------------*/	// 담당조사관정보추가 // 20100503 / 정광식	ArrayList arrDamCenter = new ArrayList();	ArrayList arrUserName = new ArrayList();	ArrayList arrDeptName = new ArrayList();	ArrayList arrCVSNo = new ArrayList();	// 제조 업종배열	ArrayList arrDCode = new ArrayList();	ArrayList arrDName = new ArrayList();	// 건설 업종배열	ArrayList arrCCode = new ArrayList();	ArrayList arrCName = new ArrayList();	// 용역 업종배열	ArrayList arrSrvCode = new ArrayList();	ArrayList arrSrvName = new ArrayList();	// 담당자 배열	ArrayList arrDeptSeq = new ArrayList();	ArrayList arrDeptCode = new ArrayList();	ArrayList arrDamName = new ArrayList();	ConnectionResource resource = null;	Connection conn = null;	PreparedStatement pstmt = null;	ResultSet rs = null;	int sStartYear = 2000;	int i = 0;	int gesu = 0;	DecimalFormat formater = new java.text.DecimalFormat("###,###,###,###,###,###,###,###");/*-----------------------------------------------------------------------------------------------------*//*=================================== Record Selection Processing =====================================*/	int currentYear = 2016;	try {		resource = new ConnectionResource();		conn = resource.getConnection();		// 제조 업종 배열 생성		StringBuffer sbSQLs1 = new StringBuffer();		sbSQLs1.append("SELECT COMMON_CD, COMMON_NM \n");		sbSQLs1.append("FROM COMMON_CD \n");		sbSQLs1.append("WHERE ADDON_GB=?");		pstmt = conn.prepareStatement(sbSQLs1.toString());		pstmt.setString(1,"1");		rs = pstmt.executeQuery();		while (rs.next()) {			arrDCode.add(StringUtil.checkNull(rs.getString("COMMON_CD")).trim());			arrDName.add(StringUtil.checkNull(rs.getString("COMMON_NM")).trim());		}		rs.close();		// 건설 업종 배열 생성		pstmt = conn.prepareStatement(sbSQLs1.toString());		pstmt.setString(1,"2");		rs = pstmt.executeQuery();		while (rs.next()) {			arrCCode.add(StringUtil.checkNull(rs.getString("COMMON_CD")).trim());			arrCName.add(StringUtil.checkNull(rs.getString("COMMON_NM")).trim());		}		rs.close();		// 용역 업종 배열 생성		pstmt = conn.prepareStatement(sbSQLs1.toString());		pstmt.setString(1,"3");		rs = pstmt.executeQuery();		while (rs.next()) {			arrSrvCode.add(StringUtil.checkNull(rs.getString("COMMON_CD")).trim());			arrSrvName.add(StringUtil.checkNull(rs.getString("COMMON_NM")).trim());		}		rs.close();		// 2010년 담당자 세팅 방법 변경 (HADO_TB_DEPT_HISTORY)		StringBuffer sbSQLs2 = new StringBuffer();		if( st_Current_Year_n>= 2010) {			sbSQLs2.append("SELECT CVSNO DEPT_SEQ, Center_Name,User_Name \n");			sbSQLs2.append("FROM HADO_TB_DEPT_HISTORY \n");			sbSQLs2.append("WHERE Current_Year=? \n");			sbSQLs2.append("GROUP BY CVSNO, Center_Name, User_Name \n");			sbSQLs2.append("ORDER BY Center_Name, User_Name");		} else {			// 담당자별 배열 생성			sbSQLs2.append("SELECT DEPT_SEQ, CENTER_NAME, USER_NAME FROM HADO_TB_FTC_USER \n");			sbSQLs2.append("ORDER BY CENTER_NAME, USER_NAME");		}		pstmt = conn.prepareStatement(sbSQLs2.toString());		if( st_Current_Year_n>= 2010) {			pstmt.setString(1,st_Current_Year);		}		rs = pstmt.executeQuery();		while(rs.next()) {			arrDeptSeq.add(StringUtil.checkNull(rs.getString("DEPT_SEQ")).trim());			arrDeptCode.add(selDeptCode(StringUtil.checkNull(rs.getString("CENTER_NAME")).trim()));			arrDamName.add(StringUtil.checkNull(rs.getString("USER_NAME")).trim());		}		rs.close();	}	catch(Exception e){		e.printStackTrace();	}	finally {		if ( rs != null ) try{rs.close();}catch(Exception e){}		if ( pstmt != null ) try{pstmt.close();}catch(Exception e){}		if ( conn != null ) try{conn.close();}catch(Exception e){}		if ( resource != null ) resource.release();	}/*=====================================================================================================*/%><%!	public String selDeptCode(String str){		String sReturnStr = "";		if(str.equals("서울사무소") || str.equals("서울 사무소") ){			sReturnStr = "S";		}else if(str.equals("대구사무소") || str.equals("대구 사무소")){			sReturnStr = "K";		}else if(str.equals("대전사무소") || str.equals("대전 사무소")){			sReturnStr = "J";		}else if(str.equals("광주사무소") || str.equals("광주 사무소")){			sReturnStr = "G";		}else if(str.equals("부산사무소") || str.equals("부산 사무소") ){			sReturnStr = "B";		}else{			sReturnStr = "H";		}		return sReturnStr ;	}%><html><head>	<title>【관리】하도급거래 서면실태조사</title>	<link rel="stylesheet" href="/hado/hado/wTools/style.css" type="text/css">	<meta charset="euc-kr">	<script language="javascript" type="text/javascript" src="/hado/hado/wTools/inc/ajax_layer.js"></script>	<script language="javascript" type="text/javascript" src="/hado/hado/wTools/inc/common_script.js"></script>	<script type="text/JavaScript">	//<![CDATA[		nNowProcess = 0;			function setNowProcessFalse() {			nNowProcess = 0;			bodyview();		}			var dcd=new Array();		var dnm=new Array();		<%		for(i=0; i<arrDCode.size(); i++) {			out.print("dcd["+i+"]='"+arrDCode.get(i)+"';");			out.print("dnm["+i+"]='"+arrDName.get(i)+"';");		}		%>		var ccd=new Array();		var cnm=new Array();		<%		for(i=0; i<arrCCode.size(); i++) {			out.print("ccd["+i+"]='"+arrCCode.get(i)+"';");			out.print("cnm["+i+"]='"+arrCName.get(i)+"';");		}		%>			var srvcd=new Array();		var srvnm=new Array();		<%		for(i=0; i<arrSrvCode.size(); i++) {			out.print("srvcd["+i+"]='"+arrSrvCode.get(i)+"';");			out.print("srvnm["+i+"]='"+arrSrvName.get(i)+"';");		}		%>			var dseq=new Array();		var dcode=new Array();		var dname=new Array();		<%		for(i=0; i<arrDeptSeq.size(); i++) {			out.print("dseq["+i+"]='"+arrDeptSeq.get(i)+"';");			out.print("dcode["+i+"]='"+arrDeptCode.get(i)+"';");			out.print("dname["+i+"]='"+arrDamName.get(i)+"';");		}		%>			function deptsel() {			var obj1 = document.getElementById("mareacode");			var obj2 = document.getElementById("mdeptname");				initsel2();				chval = obj1.options[obj1.selectedIndex].value;			obj2.add(new Option("전체","",true,true));				for(i=0; i<dseq.length; i++) {				if( dcode[i]==chval ) obj2.add(new Option(dname[i],dseq[i],false,false));			}				obj2.reInitializeSelectBox();		}			function initsel2() {			var obj = document.getElementById("mdeptname");			for(i=0; i<100; i++) obj.options[0]=null;		}			function gbsel() {			var obj1 = document.getElementById("wgb");			var obj2 = document.getElementById("sgb");				initsel();				switch(obj1.selectedIndex) {				case 1:					obj2.add(new Option("전체","",true,true));					for(i=0; i<dcd.length; i++) {						obj2.add(new Option(dnm[i],dcd[i],false,false));					}					break;				case 2:					obj2.add(new Option("전체","",true,true));					for(i=0; i<ccd.length; i++) {						obj2.add(new Option(cnm[i],ccd[i],false,false));					}					break;				case 3:					obj2.add(new Option("전체","",true,true));					for(i=0; i<srvcd.length; i++) {						obj2.add(new Option(srvnm[i],srvcd[i],false,false));					}					break;			}				obj2.reInitializeSelectBox();		}			function initsel() {			var obj = document.getElementById("sgb");				for(i=0; i<100; i++) obj.options[0]=null;		}			function goSearch() {			var frm = document.searchform;			msg = "";				if(nNowProcess == 0) {				frm.target="procFrame";				frm.action="SOent_Search.jsp?comm=search";				frm.submit();				nNowProcess = 1;				bodyhidden();			} else {				alert("현재 프로세스가 실행중입니다.\n\n잠시 후 다시 실행해 주세요.");			}		}			function pmove(val) {			if(val!="") {				var frm = document.searchform;					frm.target="procFrame";				frm.action=val;				frm.submit();				nNowProcess = 1;				bodyhidden();			}		}			function entsub(event,form) {			if (window.event && window.event.keyCode == 13)			{				goSearch();			}		}				function HelpWindow2(url, w, h) {			helpwindow = window.open(url, "HelpWindow", "toolbar=no,width="+w+",height="+h+",directories=no,status=yes,scrollbars=yes,resize=no,menubar=no,location=no");			helpwindow.focus();		}			var sSearchWin = "0";		function divSearchWin() {			obj = document.getElementById("searchbox");			wobj = document.getElementById("divSrchWindow");				if( sSearchWin =="0" ) {				obj.style.display = 'none';				wobj.innerHTML = "<a href='javascript:divSearchWin();' class='sbutton'>검색창 펼치기</a>";				sSearchWin = "1";			} else {				obj.style.display = '';				wobj.innerHTML = "<a href='javascript:divSearchWin();' class='sbutton'>검색창 가리기</a>";				sSearchWin = "0";			}		}			function view(mno,cyear,ogb,sno) {			var lyView=document.getElementById("divView");				if(nNowProcess == 0) {				document.procFrame.location.replace("SOent_View.jsp?no="+mno+"&yyyy="+cyear+"&gb="+ogb+"&sno="+sno);				nNowProcess = 1;				bodyhidden();				lyView.style.top=Math.round(( getDocumentHeight()+getVerticalScroll()-60 )/6)+"px";				lyView.style.display="block";			} else {				alert("현재 프로세스가 실행중입니다.\n\n잠시 후 다시 실행해 주세요.");			}		}			function fOentview(mno,cyear,ogb) {			var lyView=document.getElementById("divView");				if(nNowProcess == 0) {				document.procFrame.location.replace("Oent_View.jsp?no="+mno+"&yyyy="+cyear+"&gb="+ogb);				nNowProcess = 1;				bodyhidden();				lyView.style.top=Math.round(getVerticalScroll())+"px";				lyView.style.display="block";			} else {				alert("현재 프로세스가 실행중입니다.\n\n잠시 후 다시 실행해 주세요.");			}		}			function chgDongLogin(mno,cyear,ogb,sno,prpt) {			if( prpt=="Y" ) {				tmpStr = "가능";				tmpStr2 = "N";			} else if( prpt=="N" ) {				tmpStr = "차단";				tmpStr2 = "Y";			}				if( confirm("선택하신 수급사업자의 접근속성을 ["+tmpStr+"]로 변경합니다.") ) {				if(nNowProcess == 0) {					document.procFrame.location.replace("SOent_Query.jsp?sql=dontlogin&no="+mno+"&yyyy="+cyear+"&gb="+ogb+"&sno="+sno+"&proc="+tmpStr2);					nNowProcess = 1;					bodyhidden();				} else {					alert("현재 프로세스가 실행중입니다.\n\n잠시 후 다시 실행해 주세요.");				}			}		}			function f_Edit(mno,cyear,ogb,sno) {			var lyView=document.getElementById("divView");				if(nNowProcess == 0) {				document.procFrame.location.replace("SOent_Edit.jsp?no="+mno+"&yyyy="+cyear+"&gb="+ogb+"&sno="+sno);				nNowProcess = 1;				bodyhidden();				lyView.style.display="block";			} else {				alert("현재 프로세스가 실행중입니다.\n\n잠시 후 다시 실행해 주세요.");			}		}			function f_AnsDel(mno,cyear,ogb,sno) {			if( confirm("회사개요를 제외한 수급사업자가 응답한 내역을 초기화 합니다.\n\n초기화를 실행합니다.") ) {				if( confirm("초기화를 실행할 경우 복구가 불가능 합니다.\n그래도 실행 하시겠습니까?") ) {					if(nNowProcess == 0) {						document.procFrame.location.replace("SOent_Query.jsp?sql=answerinit&no="+mno+"&yyyy="+cyear+"&gb="+ogb+"&sno="+sno);						nNowProcess = 1;						bodyhidden();					} else {						alert("현재 프로세스가 실행중입니다.\n\n잠시 후 다시 실행해 주세요.");					}				}			}		}		function f_AnsDel(mno,cyear,ogb,sno) {			if(confirm("한번삭제하면 복구할수 없습니다. \n그래도 지우시겠습니까?"))				{				//main.action="query.jsp?sql=ansdel&no="+mno+"&yyyy="+cyear+"&gb="+ogb;				//main.submit()			}		}			function f_EditSubmit(inform) {			if(nNowProcess == 0) {				inform.target="procFrame";				inform.action="SOent_Query.jsp?sql=edit";				inform.submit();				bodyhidden();			} else {				alert("현재 프로세스가 실행중입니다.\n\n잠시 후 다시 실행해 주세요.");			}		}	//]]	</script></head><body>	<div id="ajax_ready" style="position:absolute;top:1px;left:1px;width:60px;height:60px;display:none;z-index:99;"><img src="/hado/hado/wTools/img/ajax_ani.gif" border="0"></div>	<div id="ajax_bg" style="position:absolute;top:1px;left:1px;display:none;background:url(/hado/hado/wTools/img/ajax_bg.gif);z-index:51;"></div>	<div id="container">		<!-- Begin Header -->		<%@ include file="/hado/wTools/inc/WB_I_pageTop.jsp"%>		<!-- End Header -->		<!-- Begin Main-menu -->		<jsp:include page="/hado/wTools/inc/WB_I_topMenu.jsp">		<jsp:param value="03" name="sel"/>		</jsp:include>		<!-- End Main-menu -->		<!-- Begin Contents -->		<div id="wrapper">			<div id="contents">				<!-- Begin Left-menu -->				<jsp:include page="/hado/wTools/inc/WB_I_SOent_LMenu.jsp">				<jsp:param value="001" name="sel"/>				</jsp:include>				<!-- End Left-menu -->				<div id="divContent">					<div id="searchContent">						<li class="subtitle">조사대상업체</li>						<li class="whereiam">HOME > 수급사업자 > 조사대상업체 > 조사대상업체</li>						<p></p>					</div>					<div class="searchbox" id="searchbox">						<table class="searchboxtable">							<tr><td><font style="color:#FF9933;font-size:9pt;">* 검색기능은 사용권한에 따라 일부 제한될 수 있습니다.</font></td></tr>						</table>						<table class="searchboxtable">						<form action="soent.jsp?comm=search" method="post" name="searchform">							<tr>								<th>조사년도</th>								<td><%									if( ckPermision.equals("T") || ckPermision.equals("M") ) {%>									<select name="cyear">										<option value="0">전체조사년도</option>										<%//for(int xx=2000; xx<=st_Current_Year_n; xx++) {											  for(int xx=2011; xx<=st_Current_Year_n; xx++) {										String tmpCYear = ""+xx;%>											<option value="<%=xx%>" <%if( xx==st_Current_Year_n ){%>selected<%}%>><%=xx%>년</option>										<%}%>									</select>									<%} else {%>									<select name="cyear">										<%for(int xx=st_Current_Year_n-1; xx<=st_Current_Year_n; xx++) {										String tmpCYear = ""+xx;%>											<option value="<%=xx%>" <%if( xx==st_Current_Year_n ){%>selected<%}%>><%=xx%>년</option>										<%}%>									</select>									<%}%>								</td>								<th><font style="color:#FF9933;font-size:9pt;">*원사업자명</font></th>								<td><%if( ckPermision.equals("T") || ckPermision.equals("M") ) {%><input type="text" name="ocomp" value="" size="25" onKeyPress="return entsub(event,this.form)" class="s_input"><%} else {%><font style="color:#c0c0c0;font-size:9pt;">-- 검색 권한없음 --</font><%}%></td>								<th><font style="color:#FF9933;font-size:9pt;">*(원)관리번호</font></td>								<td><%if( ckPermision.equals("T") || ckPermision.equals("M") ) {%><input type="text" name="unitoid" value="" size="10" onKeyPress="return entsub(event,this.form)" class="s_input"><%} else {%><font style="color:#c0c0c0;font-size:9pt;">-- 검색 권한없음 --</font><%}%></td>							</tr>							<tr>								<th>전송여부</td>								<td>									<select name="ostatus">										<option value="">전체</option>										<option value="0">미전송(소재불명등제외)</option>										<option value="2">전송완료(동일회사제외)</option>										<option value="1">전송완료</option>									</select>								</td>								<th>수급사업자명</th>								<td><input type="text" name="scomp" value="" size="25" onKeyPress="return entsub(event,this.form)" class="s_input"></td>								<th>(수)관리번호</th>								<td><input type="text" name="unitid" value="" size="10" onKeyPress="return entsub(event,this.form)" class="s_input"></td>							</tr>							<tr>								<th>업종</th>								<td>									<select name="wgb" id="wgb" onchange="gbsel();">										<option value="">전체</option>										<option value="1">제조</option>										<option value="2">건설</option>										<option value="3">용역</option>									</select>								</td>								<th>세부업종</th>								<td>									<select name="sgb" id="sgb">										<option value="">전체</option>									</select>								</td>								<th>지역</th>								<td>									<select name="local">										<option value="">전체</option>										<option value="1">강원도</option>										<option value="2">경기도</option>										<option value="3">경상남도</option>										<option value="4">경상북도</option>										<option value="5">광주광역시</option>										<option value="6">대구광역시</option>										<option value="7">대전광역시</option>										<option value="8">부산광역시</option>										<option value="9">서울특별시</option>										<option value="10">울산광역시</option>										<option value="11">인천광역시</option>										<option value="12">전라남도</option>										<option value="13">전라북도</option>										<option value="14">제주도</option>										<option value="15">충청남도</option>										<option value="16">충청북도</option>									</select>								</td>							</tr>							<tr>								<th>소재여부</th>								<td>									<select name="astatus">										<option value="">전체</option>										<option value="1">소재불명</option>										<option value="2">하도급거래없음</option>										<option value="3">수급사업자요건안됨</option>										<option value="4">중복업체</option>									</select>								</td>								<th>반송여부</td>								<td>									<select name="returngb">										<option value="">전체</option>										<option value="1">반송</option>									</select>								</td>								<th>관리번호 끝번호</td>								<td>									<select name="mlast">										<option value="" >전체</option>									<%for(int j=0 ;  j <10 ;  j++){%>										<option value="<%=j%>"><%=j%></option>									<%}%>									</select>								</td>							</tr>							<tr>								<th>담당사무소</td>								<td>									<select name="mareacode" id="mareacode" onchange="deptsel();">										<option value="">전체</option>										<option value="H">기업협력국</option>										<option value="S">서울사무소</option>										<option value="B">부산사무소</option>										<option value="G">광주사무소</option>										<option value="J">대전사무소</option>										<option value="K">대구사무소</option>									</select>								</td>								<th>담당관</td>								<td>									<select name="mdeptname" id="mdeptname">										<option value="">전체</option>									</select>								</td>								<th>출력수</td>								<td>									<select name="mpagesize">										<option value="10">10개씩 출력</option>										<option value="20">20개씩 출력</option>										<option value="30">30개씩 출력</option>										<option value="40">40개씩 출력</option>										<option value="50">50개씩 출력</option>										<option value="100">100개씩 출력</option>									</select>								</td>							</tr>							<tr>								<th>정렬방법</th>								<td>									<select name="ssort">										<option value="">없음</option>										<option value="1">사업자명</option>										<option value="2">시공액</option>										<option value="4">매출액</option>										<option value="3">관리번호</option>									</select>								</td>								<th>(수)ID구간</th>								<td colspan="3">									<input type="text" name="csid" class="s_input">									~									<input type="text" name="ceid" onkeypress="return entsub(event,this.form)" class="s_input">								</td>							</tr>							<tr>								<th>선정여부</th>								<td colspan="5"><input type="checkbox" value="1" name="mselgb" checked> 조사대상 수급사업자만 보기</td>							</tr>							</form>						</table>					</div>					<div id="divButton">						<ul class="lt">							<li class="fr" id="divSrchWindow"><a href="javascript:divSearchWin();" class="sbutton">검색창 가리기</a></li>							<li class="fr"><a href="javascript:document.searchform.reset();" class="sbutton">검색 초기화</a></li>							<li class="fr"><a href="javascript:goSearch();" class="sbutton">검 색</a></li>						</ul>					</div>					<div id="divResult">					</div>					<div id="divView" onMouseDown="f_DragMDown(this)">					</div>				</div>				<iframe src="about:blank" width="1" height="1" id="procFrame" name="procFrame" style="display:none;"></iframe>			</div>		</div>		<!-- End Contents -->		<!-- Begin Footer -->		<%@ include file="/hado/wTools/inc/WB_I_Copyright.jsp"%>		<!-- End Footer -->	</div></body></html>