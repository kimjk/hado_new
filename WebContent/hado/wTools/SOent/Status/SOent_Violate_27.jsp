<%@ page session="true" language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%><%/*** 프로젝트명	 : 하도급거래 서면실태조사 지원을 위한 개발용역 사업* 프로그램명	 : SOent_Violate_27.jsp* 프로그램설명	: 수급사업자 > 조사결과분석 > 업체별 위반항목 내역* 프로그램버전	: 1.0.1* 최초작성일자	: 2015년 09월 01일* 작 성 이 력       :*=========================================================*	작성일자		작성자명				내용*=========================================================*	2015-09-01	강슬기       페이지 최신화(주석, 불필요한 코드 제거, 오래된 코드 수정)*   2016-01-07  이용광        DB변경으로 인한 인코딩 변경*/%><%@ page import="java.sql.*"%><%@ page import="java.util.*"%><%@ page import="ftc.util.*"%><%@ page import="ftc.db.ConnectionResource"%><%@ page import="java.text.DecimalFormat"%>
<%@ include file="/hado/wTools/inc/WB_I_Global.jsp"%><%@ include file="/hado/wTools/inc/WB_I_chkMngSession.jsp"%><%
/*---------------------------------------- Variable Difinition ----------------------------------------*/	String tt = request.getParameter("tt")==null? "":request.getParameter("tt").trim();
	String comm = request.getParameter("comm")==null? "":request.getParameter("comm").trim();	ConnectionResource resource = null;	Connection conn = null;	PreparedStatement pstmt = null;	ResultSet rs = null;	String sSQLs = "";
	// 제조 업종배열	ArrayList arrDCode = new ArrayList();	ArrayList arrDName = new ArrayList();
	// 건설 업종배열	ArrayList arrCCode = new ArrayList();	ArrayList arrCName = new ArrayList();
	// 용역 업종배열	ArrayList arrSrvCode = new ArrayList();	ArrayList arrSrvName = new ArrayList();
	//int sStartYear = 2000;	int sStartYear = 2011;
/*-----------------------------------------------------------------------------------------------------*//*=================================== Record Selection Processing =====================================*/
	String tmpYear = request.getParameter("cyear")==null? "":request.getParameter("cyear").trim();
	if( !tmpYear.equals("") ) {		session.setAttribute("cyear", tmpYear);	} else {		session.setAttribute("cyear", st_Current_Year);	}
	if( tt.equals("start") ) {		session.setAttribute("sgb", "");		session.setAttribute("wgb", "2");		session.setAttribute("violatecomp", "");		session.setAttribute("violatecompno", "");	}
	if( comm.equals("search") ) {		session.setAttribute("sgb", request.getParameter("sgb")==null? "":request.getParameter("sgb").trim());
		session.setAttribute("wgb", request.getParameter("wgb")==null? "":request.getParameter("wgb").trim());
		session.setAttribute("violatecomp", request.getParameter("violatecomp")==null? "":request.getParameter("violatecomp").trim());
		session.setAttribute("violatecompno", request.getParameter("violatecompno")==null? "":request.getParameter("violatecompno").trim());
	}
	int currentYear = st_Current_Year_n;	currentYear = Integer.parseInt(session.getAttribute("cyear")+"");
	try {		resource = new ConnectionResource();		conn = resource.getConnection();
		// 제조 업종 배열 생성		StringBuffer sbSQLs1 = new StringBuffer();
		sbSQLs1.append("SELECT COMMON_CD, COMMON_NM \n");		sbSQLs1.append("FROM COMMON_CD \n");		sbSQLs1.append("WHERE ADDON_GB=?");
		pstmt = conn.prepareStatement(sbSQLs1.toString());		pstmt.setString(1,"1");		rs = pstmt.executeQuery();
		while (rs.next()) {			arrDCode.add(StringUtil.checkNull(rs.getString("COMMON_CD")).trim());			arrDName.add(StringUtil.checkNull(rs.getString("COMMON_NM")).trim());		}		rs.close();
		// 건설 업종 배열 생성		pstmt = conn.prepareStatement(sbSQLs1.toString());		pstmt.setString(1,"2");		rs = pstmt.executeQuery();
		while (rs.next()) {			arrCCode.add(StringUtil.checkNull(rs.getString("COMMON_CD")).trim());			arrCName.add(StringUtil.checkNull(rs.getString("COMMON_NM")).trim());		}		rs.close();
		// 용역 업종 배열 생성		pstmt = conn.prepareStatement(sbSQLs1.toString());		pstmt.setString(1,"3");		rs = pstmt.executeQuery();
		while (rs.next()) {			arrSrvCode.add(StringUtil.checkNull(rs.getString("COMMON_CD")).trim());			arrSrvName.add(StringUtil.checkNull(rs.getString("COMMON_NM")).trim());		}		rs.close();	} catch(Exception e) {		e.printStackTrace();	} finally {		if(rs!=null)		try{rs.close();}	catch(Exception e){}		if(pstmt!=null)		try{pstmt.close();}	catch(Exception e){}		if(conn!=null)		try{conn.close();}	catch(Exception e){}		if(resource!=null)	resource.release();	}/*=====================================================================================================*/%><%!public String isselected(String str1, String str2){	String sReturnStr = "";
	if(str1 != null && str2 != null && str1.equals(str2) ) {		sReturnStr = " selected";	}	return sReturnStr;}%><html><head>	<title>【관리】하도급거래 서면실태조사</title>	<link rel="stylesheet" href="/hado/hado/wTools/style.css" type="text/css">	<meta charset="utf-8">	<script language="javascript" type="text/javascript" src="/hado/hado/wTools/inc/ajax_layer.js"></script>	<script language="javascript" type="text/javascript" src="/hado/hado/wTools/inc/common_script.js"></script>	<script type="text/javascript">	//<![CDATA[	nNowProcess = 0;	function setNowProcessFalse(){		nNowProcess = 0;		bodyview();	}	var dcd=new Array();	var dnm=new Array();	<%	for(int i=0; i<arrDCode.size(); i++) {		out.print("dcd["+i+"]='"+arrDCode.get(i)+"';");		out.print("dnm["+i+"]='"+arrDName.get(i)+"';");	}	%>	var ccd=new Array();	var cnm=new Array();	<%	for(int i=0; i<arrCCode.size(); i++) {		out.print("ccd["+i+"]='"+arrCCode.get(i)+"';");		out.print("cnm["+i+"]='"+arrCName.get(i)+"';");	}	%>	var srvcd=new Array();	var srvnm=new Array();	<%	for(int i=0; i<arrSrvCode.size(); i++) {		out.print("srvcd["+i+"]='"+arrSrvCode.get(i)+"';");		out.print("srvnm["+i+"]='"+arrSrvName.get(i)+"';");	}	%>	function initsel() {		var obj = document.getElementById("sgb");		for(i=0; i<100; i++) obj.options[0]=null;	}	function gbsel() {		var obj1 = document.getElementById("wgb");		var obj2 = document.getElementById("sgb");		initsel();		switch(obj1.selectedIndex) {			case 0:				obj2.add(new Option("전체","",true,true));				for(i=0; i<dcd.length; i++) {					obj2.add(new Option(dnm[i],dcd[i],false,false));				}				break;			case 1:				obj2.add(new Option("전체","",true,true));				for(i=0; i<ccd.length; i++) {					obj2.add(new Option(cnm[i],ccd[i],false,false));				}				break;			case 2:				obj2.add(new Option("전체","",true,true));				for(i=0; i<srvcd.length; i++) {					obj2.add(new Option(srvnm[i],srvcd[i],false,false));				}				break;		}		obj2.reInitializeSelectBox();	}	function goSearch() {		var frm = document.searchform;		msg = "";		if(nNowProcess == 0) {			frm.target="procFrame";			frm.action="SOent_Violate_27_proc.jsp?comm=search";			frm.submit();			nNowProcess = 1;			bodyhidden();		} else {			alert("현재 프로세스가 실행중입니다.\n\n잠시 후 다시 실행해 주세요.");		}	}	var sSearchWin = "0";	function divSearchWin() {		obj = document.getElementById("searchbox");		wobj = document.getElementById("divSrchWindow");		if( sSearchWin =="0" ) {			obj.style.display = 'none';			wobj.innerHTML = "<a href='javascript:divSearchWin();' class='sbutton'>검색창 펼치기</a>";			sSearchWin = "1";		} else {			obj.style.display = '';			wobj.innerHTML = "<a href='javascript:divSearchWin();' class='sbutton'>검색창 가리기</a>";			sSearchWin = "0";		}	}	function sviolatef() {		var frm = document.searchform;		msg = "";		var lyView=document.getElementById("divView");		if(nNowProcess == 0) {			frm.target="procFrame";			frm.action="SOent_Violate_26s.jsp";			frm.submit();			nNowProcess = 1;			bodyhidden();			lyView.style.top=Math.round(( getDocumentHeight()+getVerticalScroll()-60 )/6)+"px";			lyView.style.display="block";		} else {			alert("현재 프로세스가 실행중입니다.\n\n잠시 후 다시 실행해 주세요.");		}	}	function selectf(val, val1, val2) {		var frm=document.searchform;		frm.violatecomp.value = all_replace(val,"_"," ");		frm.violatecompno.value = val1;		closeViewWin('divView');	}	function clearoentf() {		var frm=document.searchform;		frm.violatecomp.value = "";		frm.violatecompno.value = "";	}	//]]</script></head><body>	<div id="ajax_ready" style="position:absolute;top:1px;left:1px;width:60px;height:60px;display:none;z-index:99;"><img src="/hado/hado/wTools/img/ajax_ani.gif" border="0"></div>	<div id="ajax_bg" style="position:absolute;top:1px;left:1px;display:none;background:url(/hado/hado/wTools/img/ajax_bg.gif);z-index:51;"></div>
	<div id="container">		<!-- Begin Header -->		<%@ include file="/hado/wTools/inc/WB_I_pageTop.jsp"%>		<!-- End Header -->
		<!-- Begin Main-menu -->		<jsp:include page="/hado/wTools/inc/WB_I_topMenu.jsp">		<jsp:param value="03" name="sel"/>		</jsp:include>		<!-- End Main-menu -->
		<!-- Begin Contents -->		<div id="wrapper">			<div id="contents">				<!-- Begin Left-menu -->				<jsp:include page="/hado/wTools/inc/WB_I_SOent_LMenu.jsp">				<jsp:param value="039" name="sel"/>				</jsp:include>				<!-- End Left-menu -->
				<div id="divContent">					<div id="searchContent">						<li class="subtitle">업체별 위반항목 내역</li>						<li class="whereiam">HOME > 수급사업자 > 조사결과분석 > 업체별 위반항목 내역</li>						<p></p>					</div>					<div class="searchbox" id="searchbox">						<table class="searchboxtable">						<form action="" method="post" name="searchform">							<tr>								<th>조사년도</th>								<td>									<select name="cyear">										<%for(int xx=sStartYear; xx<=st_Current_Year_n; xx++) {										String tmpCYear = ""+xx;%>											<option value="<%=xx%>" <%if( xx==st_Current_Year_n ){%>selected<%}%>><%=xx%>년</option>										<%}%>									</select>								</td>								<th>원사업자구분</th>								<td>									<select name="wgb" id="wgb" onchange="gbsel();">										<option value="1">제조</option>										<option value="2">건설</option>										<option value="3">용역</option>									</select>								</td>								<th>업종</th>								<td>									<select name="sgb" id="sgb">										<option value="">전체</option>										<%										for(int j=0 ; j < arrDCode.size() ; j++) { %>											<option value="<%=arrDCode.get(j)%>"><%=arrDName.get(j)%></option>										<%										} %>									</select>								</td>							</tr>							<tr>								<th>원사업자명</th>								<td><input type="text" name="violatecomp" value="" class="s_input"></td>								<th>원사업자코드</th>								<td><input type="text" name="violatecompno" value="" class="s_input"></td>								<td colspan="2">									<li class="fl lt"><a href="javascript:sviolatef();" class="sbutton">원사업자검색</a></li>									<li class="fl lt"><a href="javascript:clearoentf();" class="sbutton">검색초기화</a></li>								</td>							</tr>							</form>						</table>					</div>
					<div id="divButton">						<ul class="lt">							<li class="fr" id="divSrchWindow"><a href="javascript:divSearchWin();" class="sbutton">검색창 가리기</a></li>							<li class="fr"><a href="javascript:goSearch();" class="sbutton">검 색</a></li>						</ul>					</div>
					<div id="divResult" style="position:absolute;top:145px;z-index:59;background-color:#ffffff;">
					</div>
					<div id="divView" onMouseDown="f_DragMDown(this)" style="z-index:61;">
					</div>				</div>				<iframe src="about:blank" width="1" height="1" id="procFrame" name="procFrame" style="display:none;"></iframe>			</div>		</div>		<!-- End Contents -->
		<!-- Begin Footer -->		<%@ include file="/hado/wTools/inc/WB_I_Copyright.jsp"%>		<!-- End Footer -->	</div></body></html>