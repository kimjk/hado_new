<%@ page session="true" language="java" contentType="text/html; charset=euc-kr" pageEncoding="euc-kr"%><%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %><%/*** 프로젝트명	: 하도급거래 서면실태조사 지원을 위한 개발용역 사업* 프로그램명	: Correct_Search.jsp* 프로그램설명	: 자진시정 사업자 검색* 프로그램버전	: 2.0.1* 최초작성일자	: 2009년 05월* 작 성 이 력       :*=========================================================*	작성일자		작성자명				내용*=========================================================*	2009-05-00	정광식       최초작성*	2011-10-18	정광식		웹관리툴 리뉴얼* 	2015-09-15	정광식       불필요한 SQL 제거 (쓸때없이 여러개의 View 를 참조)*	2015-12-30	정광식		DB변경으로 인한 인코딩 변경*	2018-10-22	김보선		2018년 자료에 맞게 쿼리 및 데이터 변경*/%><%@ page import="java.sql.*"%><%@ page import="java.util.*"%><%@ page import="ftc.util.*"%><%@ page import="ftc.db.ConnectionResource"%><%@ page import="ftc.db.ConnectionResource2"%><%@ page import="java.text.DecimalFormat"%><%@ include file="/hado/wTools/inc/WB_I_Global.jsp"%><%@ include file="/hado/wTools/inc/WB_I_chkMngSession.jsp"%><%/*---------------------------------------- Variable Difinition ----------------------------------------*/	// 리스트 배열	ArrayList arrMngNo = new ArrayList();	ArrayList arrCYear = new ArrayList();	ArrayList arrOentGB = new ArrayList();	ArrayList arrOentName = new ArrayList();	ArrayList arrOentCaptine = new ArrayList();	ArrayList arrWriterName = new ArrayList();	ArrayList arrWriterTel = new ArrayList();	ArrayList arrWriterFax = new ArrayList();	ArrayList arrSubconCnt = new ArrayList();	ArrayList arrPostNo1 = new ArrayList();	ArrayList arrPostNo2 = new ArrayList();	ArrayList arrPostNo3 = new ArrayList();	ArrayList arrPostNo4 = new ArrayList();	ArrayList arrPostNo5 = new ArrayList();	ArrayList arrPostNo6 = new ArrayList();	ArrayList arrSurveyGB = new ArrayList();	ArrayList arrSurveyMoneyGB = new ArrayList();	// 담당조사관정보추가 // 20100503 / 정광식	ArrayList arrDamCenter = new ArrayList();	ArrayList arrUserName = new ArrayList();	ArrayList arrDeptName = new ArrayList();	ArrayList arrCVSNo = new ArrayList();	ArrayList arrInsertF = new ArrayList();        // 시정조치 첨부파일	ArrayList arrSfile = new ArrayList();	ArrayList arrSType = new ArrayList();	String sComm = request.getParameter("comm")==null ? "":request.getParameter("comm").trim();	String sTComm = request.getParameter("tt")==null ? "":request.getParameter("tt").trim();	String sSQLWhere = "";	String sSQLs = "";	String sSQLs1 = "";	String sSQLs2 = "";	String sTmpStr="";	String sTmpStr1="";	String sTmpStr2="";	ConnectionResource resource = null;	Connection conn = null;	PreparedStatement pstmt = null;	ResultSet rs = null;	int sStartYear = 2000;	int nRowSizes = 70;	int currentYear = 0;	// Page	int nPageSize = 10;	String sTmpPageSize = request.getParameter("mpagesize")==null ? "":(String)request.getParameter("mpagesize").trim();	if( sTmpPageSize != null && (!sTmpPageSize.equals("")) ) {		nPageSize = Integer.parseInt(sTmpPageSize);		session.setAttribute("pagecnt",sTmpPageSize);	} else {		String sTmpPages = (String)session.getAttribute("pagecnt");		if( sTmpPages != null && (!sTmpPages.equals("")) ) {			nPageSize = Integer.parseInt(sTmpPages);			session.setAttribute("pagecnt",sTmpPages);		} else {			nPageSize = 10;		}	}	int nPage = 1;	int nMaxPage = 1;	int nRecordCount = 0;	String sTmpPage = request.getParameter("page")==null ? "":(String)request.getParameter("page").trim();	if( sTmpPage != null && (!sTmpPage.equals("")) ) {		nPage = Integer.parseInt(sTmpPage);		session.setAttribute("page", sTmpPage);	} else {		String sTmpPages = (String)session.getAttribute("page");		if( sTmpPages != null && (!sTmpPages.equals("")) ) {			nPage = Integer.parseInt(sTmpPages);			session.setAttribute("page", sTmpPages);		} else {			nPage = 1;		}	}	int i = 0;	int gesu = 0;	DecimalFormat formater = new java.text.DecimalFormat("###,###,###,###,###,###,###,###");/*-----------------------------------------------------------------------------------------------------*//*=================================== Record Selection Processing =====================================*/	if( sTComm.equals("start") ) {		session.setAttribute("cyear", st_Current_Year);		session.setAttribute("wgb", "");		session.setAttribute("sgb", "");		session.setAttribute("scomp", "");		session.setAttribute("ssort", "1");		session.setAttribute("csid", "");		session.setAttribute("ceid", "");		session.setAttribute("oareacode", "");		session.setAttribute("odeptname", "");		session.setAttribute("unitid", "");		session.setAttribute("pagecnt", "10");		session.setAttribute("page", "1");		session.setAttribute("surgb","");		session.setAttribute("insertf","");	}	if( sComm.equals("search") ) {		session.setAttribute("cyear", request.getParameter("cyear")==null ? "":request.getParameter("cyear").trim());		session.setAttribute("sgb",request.getParameter("sgb")==null ? "":request.getParameter("sgb").trim());		session.setAttribute("wgb",request.getParameter("wgb")==null ? "":request.getParameter("wgb").trim());		session.setAttribute("scomp",request.getParameter("scomp")==null ? "":request.getParameter("scomp").trim());		session.setAttribute("ssort",request.getParameter("ssort")==null ? "":request.getParameter("ssort").trim());		session.setAttribute("csid",request.getParameter("csid")==null ? "":request.getParameter("csid").trim());		session.setAttribute("ceid",request.getParameter("ceid")==null ? "":request.getParameter("ceid").trim());		session.setAttribute("oareacode",request.getParameter("mareacode")==null ? "":request.getParameter("mareacode").trim());		session.setAttribute("odeptname",request.getParameter("mdeptname")==null ? "":request.getParameter("mdeptname").trim());		session.setAttribute("unitid",request.getParameter("unitid")==null ? "":request.getParameter("unitid").trim());		session.setAttribute("pagecnt",request.getParameter("mpagesize")==null ? "":request.getParameter("mpagesize").trim());		session.setAttribute("page", request.getParameter("page")==null ? "":request.getParameter("page").trim());		session.setAttribute("surgb", request.getParameter("surgb")==null ? "":request.getParameter("surgb").trim());		session.setAttribute("insertf", request.getParameter("insertf")==null ? "":request.getParameter("insertf").trim());	}	if( !session.getAttribute("cyear").equals("") ) {		currentYear = Integer.parseInt(session.getAttribute("cyear").toString());	} else {		currentYear = 0;	}	// view table name	String currentSurveyList = currentYear>=2012 ? "HADO_VT_Survey_List_"+currentYear : "HADO_VT_Survey_List";	sSQLs2="SELECT * FROM ( \n";	sSQLs2+="SELECT TT.*, FLOOR( (ROWNUM-1)/"+nPageSize+"+1 ) AS PAGE FROM ( \n";	sTmpStr=session.getAttribute("cyear")+"";	if( (currentYear>=2012) ) {	    /* 2015-09-15 / 정광식 / 불필요한 SQL 제거 (쓸때없이 여러개의 View 를 참조)		sSQLs1= "SELECT COUNT(*) RECCNT FROM ( \n";		sSQLs1+="	SELECT A1.*,A2.Insert_F \n";		sSQLs1+="	FROM HADO_VT_OENT_"+currentYear+" A1 \n";		sSQLs1+="	LEFT JOIN "+currentSurveyList+" A2 \n";		sSQLs1+="	ON A1.Mng_No=A2.Mng_No \n";		sSQLs1+="		AND A1.Current_Year=A2.Current_Year \n";		sSQLs1+="		AND A1.Oent_GB=A2.Oent_GB ) \n";		sSQLs= "SELECT * FROM ( \n";		sSQLs+="	SELECT A1.*,A2.Insert_F \n";		sSQLs+="	FROM HADO_VT_OENT_"+currentYear+" A1 \n";		sSQLs+="	LEFT JOIN "+currentSurveyList+" A2 \n";		sSQLs+="	ON A1.Mng_No=A2.Mng_No \n";		sSQLs+="		AND A1.Current_Year=A2.Current_Year \n";		sSQLs+="		AND A1.Oent_GB=A2.Oent_GB ) \n";		*/		sSQLs1= "SELECT COUNT(*) RECCNT \n";		sSQLs1+="FROM ( \n";		sSQLs1+="	SELECT A.*,B.POST_NO_01,B.POST_NO_02,B.POST_NO_03,B.POST_NO_04,B.POST_NO_05 \n";		if(currentYear>=2018) {			sSQLs1+="	, B.POST_NO_06 \n";					}		sSQLs1+="	FROM HADO_VT_Survey_List_"+currentYear+" A \n";		sSQLs1+="	LEFT JOIN HADO_TB_OENT_POSTNO_"+currentYear+" B \n";		sSQLs1+="	ON A.MNG_NO=B.MNG_NO AND A.CURRENT_YEAR=B.CURRENT_YEAR AND A.OENT_GB=B.OENT_GB \n";		sSQLs1+=") jT \n";		sSQLs= "SELECT * \n";		sSQLs+="FROM ( \n";		sSQLs+="	SELECT A.*,B.POST_NO_01,B.POST_NO_02,B.POST_NO_03,B.POST_NO_04,B.POST_NO_05 \n";		if(currentYear>=2018) {			sSQLs+="	, B.POST_NO_06 \n";					}			if(currentYear ==2021) {		    sSQLs+="    ,(SELECT file_name                                                              \n";  		    sSQLs+="     FROM HADO_TB_OENT_SELFCORREC_FILE F                                            \n";		    sSQLs+="     WHERE A.mng_no = F.mng_no                                                      \n";		    sSQLs+="     AND F.current_year = '"+currentYear+"'                                         \n";		    sSQLs+="     AND F.file_sn = (SELECT MAX(FF.file_sn) FROM HADO_TB_OENT_SELFCORREC_FILE FF   \n";		    sSQLs+="     WHERE A.mng_no = FF.mng_no                                                     \n";		    sSQLs+="     AND FF.current_year = '"+currentYear+"'                                        \n";		    sSQLs+="     )) sfile                                                                       \n";		    sSQLs+="    ,(SELECT Type                                                                   \n";  		    sSQLs+="     FROM HADO_TB_OENT_SELFCORREC_FILE F                                            \n";		    sSQLs+="     WHERE A.mng_no = F.mng_no                                                      \n";		    sSQLs+="     AND F.current_year = '"+currentYear+"'                                         \n";		    sSQLs+="     AND F.file_sn = (SELECT MAX(FF.file_sn) FROM HADO_TB_OENT_SELFCORREC_FILE FF   \n";		    sSQLs+="     WHERE A.mng_no = FF.mng_no                                                     \n";		    sSQLs+="     AND FF.current_year = '"+currentYear+"'                                        \n";		    sSQLs+="     )) sType                                                                       \n";		}		sSQLs+="	FROM HADO_VT_Survey_List_"+currentYear+" A \n";		sSQLs+="	LEFT JOIN HADO_TB_OENT_POSTNO_"+currentYear+" B \n";		sSQLs+="	ON A.MNG_NO=B.MNG_NO AND A.CURRENT_YEAR=B.CURRENT_YEAR AND A.OENT_GB=B.OENT_GB \n";		sSQLs+=") jT \n";	} else if( (currentYear>=2010) ) {		sSQLs1= "SELECT COUNT(*) RECCNT FROM ( \n";		sSQLs1+="	SELECT A1.*,A2.Insert_F \n";		sSQLs1+="	FROM HADO_VT_OENT_2010 A1 \n";		sSQLs1+="	LEFT JOIN "+currentSurveyList+" A2 \n";		sSQLs1+="	ON A1.Mng_No=A2.Mng_No \n";		sSQLs1+="		AND A1.Current_Year=A2.Current_Year \n";		sSQLs1+="		AND A1.Oent_GB=A2.Oent_GB ) \n";		sSQLs= "SELECT * FROM ( \n";		sSQLs+="	SELECT A1.*,A2.Insert_F \n";		sSQLs+="	FROM HADO_VT_OENT_2010 A1 \n";		sSQLs+="	LEFT JOIN "+currentSurveyList+" A2 \n";		sSQLs+="	ON A1.Mng_No=A2.Mng_No \n";		sSQLs+="		AND A1.Current_Year=A2.Current_Year \n";		sSQLs+="		AND A1.Oent_GB=A2.Oent_GB ) \n";	} else {		sSQLs1= "SELECT COUNT(*) RECCNT FROM ( \n";		sSQLs1+="	SELECT A1.*,A2.Insert_F \n";		sSQLs1+="	FROM HADO_VT_OENT A1 \n";		sSQLs1+="	LEFT JOIN "+currentSurveyList+" A2 \n";		sSQLs1+="	ON A1.Mng_No=A2.Mng_No \n";		sSQLs1+="		AND A1.Current_Year=A2.Current_Year \n";		sSQLs1+="		AND A1.Oent_GB=A2.Oent_GB ) \n";		sSQLs= "SELECT * FROM ( \n";		sSQLs+="	SELECT A1.*,A2.Insert_F \n";		sSQLs+="	FROM HADO_VT_OENT_2010 A1 \n";		sSQLs+="	LEFT JOIN "+currentSurveyList+" A2 \n";		sSQLs+="	ON A1.Mng_No=A2.Mng_No \n";		sSQLs+="		AND A1.Current_Year=A2.Current_Year \n";		sSQLs+="		AND A1.Oent_GB=A2.Oent_GB ) \n";	}	sSQLWhere="";	if( !session.getAttribute("wgb").toString().equals("") ) {		sSQLWhere+="AND OENT_GB='"+session.getAttribute("wgb")+"' \n";	} else {		if( currentYear>=2010 ) {			sSQLWhere+="AND (OENT_GB='1' OR Oent_GB='2' OR OENT_GB='3') \n";		} else {			if( currentYear>=2006 ) {				sSQLWhere+="AND (OENT_GB='1' OR OENT_GB='3') \n";			}		}	}	if( !session.getAttribute("sgb").toString().equals("") ) {		//sSQLWhere+="AND OENT_TYPE='"+session.getAttribute("sgb")+"' \n";		//20171122 업종코드 조회 오류 수정 		sSQLWhere+="AND SUBSTR(MNG_NO, 2, 3)='"+session.getAttribute("sgb")+"' \n";			}	if( !session.getAttribute("scomp").toString().equals("") ) {		sSQLWhere+="AND REPLACE(OENT_NAME,' ','') LIKE '%"+session.getAttribute("scomp")+"%' \n";	}	if( !session.getAttribute("csid").toString().equals("") ) {		String tmpStr=session.getAttribute("csid")+"";		sSQLWhere+="AND MNG_NO>='"+tmpStr.toUpperCase()+"' \n";	}	if( !session.getAttribute("ceid").toString().equals("") ) {		String tmpStr=session.getAttribute("ceid")+"";		sSQLWhere+="AND MNG_NO<='"+tmpStr.toUpperCase()+"' \n";	}	if( !session.getAttribute("unitid").toString().equals("") ) {		String tmpStr=session.getAttribute("unitid")+"";		sSQLWhere+="AND MNG_NO='"+tmpStr.toUpperCase()+"' \n";	}	if( !session.getAttribute("oareacode").toString().equals("") ) {		//sTmpStr1=new String(selDeptName(session.getAttribute("oareacode")+"").getBytes("EUC-KR"),"ISO8859-1");		sTmpStr1=selDeptName(session.getAttribute("oareacode")+"");		sSQLWhere+="AND Center_Name LIKE '"+sTmpStr1+"%' \n";				String areaCode = session.getAttribute("oareacode").toString();		if(areaCode.length() == 2) {			//if(areaCode.indexOf("H") > -1) sSQLWhere += " AND Center_Name LIKE '본부%' \n";			if("H1".equals(areaCode)) sSQLWhere += " AND DEPT_NAME LIKE '기업%' \n";			if("H2".equals(areaCode)) sSQLWhere += " AND DEPT_NAME LIKE '제조%' \n";			if("H3".equals(areaCode)) sSQLWhere += " AND DEPT_NAME LIKE '건설%' \n";						//if(areaCode.indexOf("S") > -1) sSQLWhere += " AND Center_Name LIKE '서울%' \n";			if("S1".equals(areaCode)) sSQLWhere += " AND DEPT_NAME LIKE '건설%' \n";			if("S2".equals(areaCode)) sSQLWhere += " AND DEPT_NAME LIKE '제조%' \n";		}	}	// 시정조치 입력여부 추가 - 정광식	if( !session.getAttribute("insertf").toString().equals("") ) {		sSQLWhere+="AND Insert_F='"+session.getAttribute("insertf")+"' \n";	}	// 2010년 담당자 세팅 방법 변경 (HADO_TB_DEPT_HISTORY)	if( currentYear>=2010) {		if( !session.getAttribute("odeptname").toString().equals("") ) {			sSQLWhere+="AND CVSNO='"+session.getAttribute("odeptname")+"' \n";		}	} else {		if( !session.getAttribute("odeptname").toString().equals("") ) {			sSQLWhere+="AND DEPT_SEQ="+session.getAttribute("odeptname")+" \n";		}	}	if( !session.getAttribute("surgb").toString().equals("") ) {		if( session.getAttribute("surgb").toString().equals("21") ) {			sSQLWhere+="AND Survey_GB='2' \n";			sSQLWhere+="AND Survey_Money_GB='1' \n";		} else if( session.getAttribute("surgb").toString().equals("20") ) {			sSQLWhere+="AND Survey_GB='2' \n";			if( currentYear>=2014) {				sSQLWhere+="AND Survey_Money_GB='2' \n";			} else {				sSQLWhere+="AND Survey_Money_GB IS NULL \n";			}		} else {			sSQLWhere+="AND Survey_GB='"+session.getAttribute("surgb")+"' \n";		}	} else {		sSQLWhere+="AND Survey_GB IS NOT NULL \n";	}	// 예시데이타는 관리번호 뒤에 1234567 삽입했음 (예외처리 필요)	//sSQLs1+=" WHERE SUBSTR(MNG_NO,-7) <> '1234567'";	sSQLs+="WHERE MNG_NO IS NOT NULL \n";	if( currentYear > 0 ) {		sSQLs+="AND CURRENT_YEAR='"+currentYear+"' \n";	}	sSQLs+=sSQLWhere;	if( session.getAttribute("ssort").toString().equals("1") ) {		sSQLs+="ORDER BY REPLACE(OENT_NAME,'(','') \n";	}	if( session.getAttribute("ssort").toString().equals("2") ) {		sSQLs+="ORDER BY OENT_ASSETS DESC \n";	}	if( session.getAttribute("ssort").toString().equals("3") ) {		sSQLs+="ORDER BY OENT_SALE02 DESC \n";	}	if( session.getAttribute("ssort").toString().equals("4") ) {		sSQLs+="ORDER BY MNG_NO \n";	}	if( session.getAttribute("ssort").toString().equals("5") ) {		sSQLs+="ORDER BY Center_Name,Dept_Name,User_Name \n";	}	if( session.getAttribute("ssort").toString().equals("") && currentYear==0 ) {		sSQLs+="ORDER BY Current_Year \n";	}	if( session.getAttribute("ssort").toString().equals("") ) {		sSQLs+="ORDER BY center_name,dept_name,user_name \n";	}	// 전체 페이지 계산을 위해 레코드 카운트	//sSQLs1+=" WHERE SUBSTR(MNG_NO,-7) <> '1234567'";	sSQLs1+="WHERE MNG_NO IS NOT NULL \n";	if( (currentYear>2010) ) {		sSQLs1+="AND LENGTH(Mng_No)>4 \n";	} else {		sSQLs1+="AND SUBSTR(Mng_No,-5) <> '12345' \n";	}	if( currentYear > 0 ) {		sSQLs1+="AND CURRENT_YEAR='"+currentYear+"' "+sSQLWhere+" \n";	}	// 페이징 처리한 쿼리문	sSQLs2+=sSQLs+") TT ) \n";	sSQLs2+="WHERE PAGE="+nPage+" \n";	//System.out.println(sSQLs1); // 페이지 계산 쿼리	try {		resource = new ConnectionResource();		conn = resource.getConnection();				//System.out.println("sSQLs1: "+sSQLs1);		pstmt=conn.prepareStatement(sSQLs1);		rs=pstmt.executeQuery();		while( rs.next()) {			nRecordCount=rs.getInt("RECCNT");		}		rs.close();		// 페이지 수 계산		if(nRecordCount > 0) {			nMaxPage=(int)Math.round(nRecordCount / (float)nPageSize + 0.4999999F);		}	} catch(Exception e) {		e.printStackTrace();	} finally {		if ( rs != null ) try{rs.close();}catch(Exception e){}		if ( pstmt != null ) try{pstmt.close();}catch(Exception e){}		if ( conn != null ) try{conn.close();}catch(Exception e){}		if ( resource != null ) resource.release();	}	try {		resource = new ConnectionResource();		conn = resource.getConnection();		System.out.println("sSQLs2: "+sSQLs2); // 검색 데이터 쿼리		//System.out.println(sSQLs2);		pstmt = conn.prepareStatement(sSQLs2);		rs = pstmt.executeQuery();		while ( rs.next()) {			arrMngNo.add( rs.getString("MNG_NO")==null ? "":rs.getString("MNG_NO").trim() );			arrCYear.add( rs.getString("Current_Year")==null ? "":rs.getString("Current_Year").trim() );			arrOentGB.add( rs.getString("OENT_GB")==null ? "":rs.getString("OENT_GB").trim() );			arrOentName.add( rs.getString("OENT_NAME")==null ? "":rs.getString("OENT_NAME").trim() );			arrOentCaptine.add( rs.getString("OENT_CAPTINE")==null ? "":rs.getString("OENT_CAPTINE").trim() );			arrWriterName.add( rs.getString("WRITER_NAME")==null ? "":rs.getString("WRITER_NAME").trim() );			arrWriterTel.add( rs.getString("WRITER_TEL")==null ? "":rs.getString("WRITER_TEL").trim() );			arrWriterFax.add( rs.getString("WRITER_FAX")==null ? "":rs.getString("WRITER_FAX").trim() );			if( (currentYear>=2010) ) {				arrCVSNo.add( rs.getString("CVSNO")==null ? "":rs.getString("CVSNO").trim() );				arrDamCenter.add( rs.getString("Center_NAME")==null ? "":rs.getString("Center_NAME").trim() );				arrDeptName.add( rs.getString("Dept_NAME")==null ? "":rs.getString("Dept_NAME").trim() );				arrUserName.add( rs.getString("User_NAME")==null ? "":rs.getString("User_NAME").trim() );			} else {				arrCVSNo.add("");				arrDamCenter.add("");				arrDeptName.add("");				arrUserName.add("");			}			arrSurveyGB.add( rs.getString("Survey_GB")==null ? "":rs.getString("Survey_GB").trim() );			arrSurveyMoneyGB.add( rs.getString("Survey_Money_GB")==null ? "":rs.getString("Survey_Money_GB").trim() );			arrPostNo1.add( rs.getString("POST_NO_01")==null ? "":rs.getString("POST_NO_01").trim() );			arrPostNo2.add( rs.getString("POST_NO_02")==null ? "":rs.getString("POST_NO_02").trim() );			arrPostNo3.add( rs.getString("POST_NO_03")==null ? "":rs.getString("POST_NO_03").trim() );			arrPostNo4.add( rs.getString("POST_NO_04")==null ? "":rs.getString("POST_NO_04").trim() );			arrPostNo5.add( rs.getString("POST_NO_05")==null ? "":rs.getString("POST_NO_05").trim() );			if(currentYear>=2018) {			    arrPostNo6.add( rs.getString("POST_NO_06")==null ? "":rs.getString("POST_NO_06").trim() );			}			if(currentYear == 2021) {			    arrSfile.add( rs.getString("sfile")==null ? "":rs.getString("sfile"));			    arrSType.add( rs.getString("sType")==null ? "":rs.getString("sType"));			}			arrInsertF.add( rs.getString("Insert_F")==null ? "":rs.getString("Insert_F").trim() );		}		rs.close();	} catch(Exception e){		e.printStackTrace();	} finally {		if ( rs != null ) try{rs.close();}catch(Exception e){}		if ( pstmt != null ) try{pstmt.close();}catch(Exception e){}		if ( conn != null ) try{conn.close();}catch(Exception e){}		if ( resource != null ) resource.release();	}/*=====================================================================================================*/%><%!	public String selDeptName(String str) {		String sReturnStr = "";		if(str.equals("S") || str.equals("S1") || str.equals("S2")) {			sReturnStr = "서울";		} else if(str.equals("K")) {			sReturnStr = "대구";		} else if(str.equals("J")) {			sReturnStr = "대전";		} else if(str.equals("G")) {			sReturnStr = "광주";		} else if(str.equals("B") ) {			sReturnStr = "부산";		} else {			sReturnStr = "본부";		}		return sReturnStr ;	}	public String selCorrectGB(String str) {		String sReturnStr="";		if( str.equals("20") ) {			sReturnStr = "비대금";		} else if( str.equals("21") ) {			sReturnStr = "대금";		} else if( str.equals("1") ) {			sReturnStr = "미제출";		} else if( str.equals("3") ) {			sReturnStr = "하도급부인";		} else if( str.equals("5") ) {			sReturnStr = "미제출(2)";		} else if( str.equals("6") ) {			sReturnStr = "불인정";		} else if( str.equals("7") ) {			sReturnStr = "미시정";		} else {			sReturnStr = "정보없음";		}		return sReturnStr ;	}%><script type="text/javascript">//<![CDATA[	content = "";	content+="<table id='divButton'>";	content+="	<tr>";	content+="		<td>검색된 회사수 : <%=formater.format(nRecordCount)%>개</strong> (page. <%=formater.format(nPage)%> / <%=formater.format(nMaxPage)%>) <a href='Correct_Search_Excel.jsp' target='_blank'><img src='../img/img_forExcel.gif'></a></td>";	content+="	</tr>";	content+="</table>";	content+="<table class='resultTable'>";	content+="	<tr>";	content+="		<th>년도</th>";	content+="		<th>조치구분</th>";	content+="		<th>업종</th>";	content+="		<th>관리번호</th>";	content+="		<th>회사명</th>";	content+="		<th>대표자명</th>";	content+="		<th>작성자</th>";	content+="		<th>조사담당</th>";	content+="		<th>등기번호</th>";	content+="		<th>시정조치</th>";    <%	if(currentYear == 2021) {	%>		content+="		<th>유형</th>";		content+="		<th>자진시정자료</th>";	<%	}    %>	content+="	</tr>";	<%if( arrMngNo.size()>0 ) {		for(int j=0; j<arrMngNo.size(); j++) {%>	content+="	<tr onMouseOver='tbRow_Over(this)' onMouseOut='tbRow_Out(this)'>";	content+="		<td><%=arrCYear.get(j)%></td>";	<%	sTmpStr1 = arrSurveyGB.get(j)+"";	if( sTmpStr1.equals("2") ) {		sTmpStr1 = arrSurveyMoneyGB.get(j)+"";		if( sTmpStr1.equals("1") ) {			sTmpStr1 = "21";		} else {			sTmpStr1 = "20";		}	} else {		sTmpStr1 = arrSurveyGB.get(j)+"";	}	sTmpStr1 = "<font style='color:#FF9933;'>"+selCorrectGB(sTmpStr1)+"</font>";	%>	content+="		<td><%=sTmpStr1%></td>";	content+="		<td><%if( arrOentGB.get(j).equals("3") ) {%>용역<%} else if( arrOentGB.get(j).equals("2") ) {%>건설<%} else {%>제조<%}%></td>";	content+="		<td><a href=javascript:view('<%=arrMngNo.get(j)%>','<%=arrCYear.get(j)%>','<%=arrOentGB.get(j)%>');><%=arrMngNo.get(j)%></a></td>";	content+="		<td><%=arrOentName.get(j)%></td>";	content+="		<td><%=arrOentCaptine.get(j)%></td>";	content+="		<td><li class='lt'><%=arrWriterName.get(j)%></li><li class='lt'>T)<%=arrWriterTel.get(j)%></li><li class='lt'>F)<%=arrWriterFax.get(j)%></li></td>";	content+="		<td><li class='lt'><%=arrDamCenter.get(j)%></li><li class='lt'><%=arrDeptName.get(j)%></li><li class='lt'><%=arrUserName.get(j)%></li></td>";	<%	if(currentYear>=2018) {	%>	content+="		<td><li class='lt'><%=arrPostNo5.get(j)%></li><li class='lt'><%=arrPostNo6.get(j)%></li></td>";	<%} else { %>			content+="		<td><li class='lt'><%=arrPostNo3.get(j)%></li><li class='lt'><%=arrPostNo4.get(j)%></li></td>";	<%} %>	content+="		<td><%if( arrInsertF.get(j).equals("1") ) {%><font style='color:#FF9933;'>입력</font><%} else {%><font style='color:#FF0000;'>미입력</font><%}%></td>";	<%	if(currentYear==2021) {	%> 		<c:set var="sType" value="<%=arrSType.get(j)%>" />		<c:if test="${sType ne ''}">		content+="<td>${sType eq '1' ? '시정 결과 및 결과보고' : '소명 공문'}</td>";    	</c:if>      	<c:if test="${sType eq ''}">  		content+="<td></td>";    	</c:if>		    <c:set var="sfile" value="<%=arrSfile.get(j)%>" />	    <c:if test="${sfile ne ''}">			content+="<td><a href=javascript:fileDown('<%=arrMngNo.get(j)%>','<%=currentYear%>','<%=arrOentGB.get(j)%>')><img src='../img/icon_pdf.gif'></a></td>";      	</c:if>	    <c:if test="${sfile eq ''}">			content+="<td></td>";      	</c:if>	<%} %>	content+="	</tr>";	<%		}	} else {%>	content+="	<tr>";	<%		 if(currentYear==2021) {	%>		content+="		<td colspan='10' class='noneResultset'>검색 결과가 없습니다</td>";	<%}else{ %>		content+="		<td colspan='9' class='noneResultset'>검색 결과가 없습니다</td>";	<%}%>	content+="	</tr>";	<%	}	%>	content+="</table>";	content+="<div id='pageMove'>";	content+="<p align='center'><%=UF_PageMove_java(nPage, nMaxPage, "pmove('Correct_Search.jsp?page=")%></p>";	content+="</div>";	top.document.getElementById("divResult").innerHTML = content;	top.setNowProcessFalse();//]]</script><%@ include file="/hado/wTools/inc/WB_I_Function.jsp"%>